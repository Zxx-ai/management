<template>
 
 <el-container class="scens">
   <!-- å¤´éƒ¨åŒºåŸŸ -->
  <el-header>
     <img src="../../assets/tb.png" alt=""> 
    <span>è“æ¼«åå°ç®¡ç†ç³»ç»Ÿ</span>
    <el-button class="but-t" type="info" @click="logouts">é€€å‡º</el-button>
    </el-header>
  <!-- é¡µé¢ä¸»ä½“åŒº -->
  <el-container>
    <!-- ä¾§è¾¹æ  -->
    <el-aside width="200px">
<!-- ä¾§è¾¹æ èœå• -->
 <el-menu
      default-active="2"
      background-color="#1C8ECF"
      text-color="#fff"
      active-text-color="#ffd04b">



   <!--el-submenu  ä¸€çº§èœå• -->
      <el-submenu index="1">

        <template slot="title">
          <i class="el-icon-s-custom"></i>
         <router-link class="scenes-data" to="/scenes"><span>ç”¨æˆ·ç®¡ç†</span></router-link>
        </template>

      </el-submenu>

      <!--el-submenu  ä¸€çº§èœå• -->
      <el-submenu index="2">

        <template slot="title">
          <i class="el-icon-video-camera"></i>
          <span>åŠ¨æ¼«ç®¡ç†</span>
        </template>

        <!-- äºŒçº§èœå• -->
         <el-menu-item index="1-4-1">

        <template slot="title">
          <i class="el-icon-video-camera-solid"></i>
          <router-link class="scenes-data" to="/movie"><span>æ•°æ®ç®¡ç†</span></router-link>
        </template>

         </el-menu-item>

 <!-- ä¸‰çº§èœå• -->
         <el-menu-item index="1-4-2">

        <template slot="title">
          <i class="el-icon-circle-plus"></i>
          <router-link class="scenes-data" to="/insetm"><span>æ–°å¢æ•°æ®</span></router-link>
        </template>

         </el-menu-item>


      </el-submenu>
  


    </el-menu>

    </el-aside>
    <!-- å³ä¾§å†…å®¹ä¸»ä½“ -->
    <el-main>
<el-button type="primary">ğŸ˜€åŠ¨æ¼«ç®¡ç†</el-button>
<el-table
    :data="tableData.filter(data => !search || data.aname.toLowerCase().includes(search.toLowerCase()))"
    style="width: 100%"
    
    >

    <el-table-column
      label="ID"
      prop="ano">
    </el-table-column>

    <el-table-column
      label="å›¾ç‰‡"
      prop="aurl">
     
    </el-table-column>

    <el-table-column
      label="åŠ¨æ¼«å"
      prop="aname">
    </el-table-column>

  <el-table-column
      label="ç±»å‹"
      prop="alx">
    </el-table-column>

    <el-table-column
      label="ä¸»è§’"
      prop="anoe">
    </el-table-column>


 <el-table-column
      label="ç®€ä»‹"
      prop="atexts">
    </el-table-column>


 <el-table-column
      label="æ—¶é—´"
      prop="adata">
    </el-table-column>

 <el-table-column
      label="è¯„åˆ†"
      prop="apf">
    </el-table-column>


    <el-table-column
      align="right">
      <template slot="header" slot-scope="scope">
        <el-input
          v-model="search"
          size="mini"
          placeholder="è¾“å…¥å…³é”®å­—æœç´¢"/>
      </template>
      <template slot-scope="scope">
       


           <el-button
          size="mini"
          @click="dialogFormVisible = true,handleEdit(scope.$index, scope.row)">ç¼–è¾‘</el-button>


        <el-button
          size="mini"
          type="danger"
          @click="handleDelete(scope.$index, scope.row)">åˆ é™¤</el-button>
      </template>
    </el-table-column>

 <el-pagination
  background
  layout="prev, pager, next"
  :total="1000">
</el-pagination>
  </el-table>





<!-- ç¼–è¾‘ -->
<el-dialog title="åŠ¨æ¼«æ•°æ®ä¿®æ”¹" :visible.sync="dialogFormVisible">
  <el-form :model="form"  ref="scenesfrom">

 <el-form-item label="ID:"  :label-width="formLabelWidth">
      <el-input :disabled="true"  v-model="form.ano" autocomplete="off"></el-input>
    </el-form-item>


     
    <el-form-item label="å›¾ç‰‡url:" :label-width="formLabelWidth">
      <el-input v-model="form.aurl" autocomplete="off"></el-input>
    </el-form-item>

    <el-form-item label="åŠ¨æ¼«å:" :label-width="formLabelWidth">
      <el-input v-model="form.aname" autocomplete="off"></el-input>
    </el-form-item>


   <el-form-item label="ç±»å‹:" :label-width="formLabelWidth">
          <el-select          
            prefix-icon="el-icon-user"
            placeholder="è¯·è¾“å…¥åŠ¨æ¼«ç±»å‹"
            v-model="form.alx"
          >
      <el-option label="çƒ­è¡€" value="çƒ­è¡€"></el-option>
      <el-option label="å‰§æƒ…" value="å‰§æƒ…"></el-option>
      <el-option label="æƒ…æ„Ÿ" value="æƒ…æ„Ÿ"></el-option>
      <el-option label="æ‚¬ç–‘" value="æ‚¬ç–‘"></el-option>
      <el-option label="å¥‡å¹»" value="å¥‡å¹»"></el-option>
      <el-option label="åŠ¨ä½œ" value="åŠ¨ä½œ"></el-option>
          </el-select>
        </el-form-item>

<el-form-item label="åŠ¨æ¼«ä¸»è§’:" :label-width="formLabelWidth">
      <el-input v-model="form.anoe" autocomplete="off"></el-input>
    </el-form-item>



    <el-form-item label="åŠ¨æ¼«ç®€ä»‹:" :label-width="formLabelWidth">
      <el-input type="textarea" v-model="form.atexts" autocomplete="off"></el-input>
    </el-form-item>

 <el-form-item label="å‘å¸ƒæ—¶é—´:" :label-width="formLabelWidth">
   <el-date-picker
      v-model="form.adata"
      type="date"
      placeholder="é€‰æ‹©æ—¥æœŸ">
    </el-date-picker>
 </el-form-item>



         <el-form-item  label="è¯„åˆ†:" :label-width="formLabelWidth">
          <el-input
            type="number"
            prefix-icon="el-icon-star-off"
            placeholder="è¯·è¯„åˆ†"
            v-model="form.apf"
            max="5"
            min="0"
          ></el-input>
        </el-form-item>
      

  </el-form>
  <div slot="footer" class="dialog-footer">
    <el-button @click="dialogFormVisible = false">å– æ¶ˆ</el-button>
    <el-button type="primary" @click="dialogFormVisible = false,animeshow(),openFullScreen2()">ç¡® å®š</el-button>
  </div>
</el-dialog>





    </el-main>
  </el-container>

</el-container>



</template>
<script>
export default {
   inject:['reload'],
  data() {
    return {
     tableData: [],
        search: '',
  dialogFormVisible: false,
        form: {
          ano: '',
          aurl: '',
          aname: '',
          alx: '',
          anoes: '',
          atexts: '',
          adata: '',
          apf: '',
          date1: '',
          date2: '',
          delivery: false,
          type: [],
          resource: '',
          desc: ''
        },
        formLabelWidth: '120px'
    }
  },

mounted() {
    this.$axios
      .get('http://localhost:4000/api/anime/Aall')
      .then(res => {
        //è¯·æ±‚æˆåŠŸ
        // console.log(res)
        if (res.status == '200') {
          if (res.data && res.data.length) {
            this.tableData = res.data
            
            
          }
        }

        // console.log(res);
      })
      .catch(err => {
        //è¯·æ±‚å¤±è´¥

        window.console.log(err)
      })
  },

  

methods:{

animeshow(){
          var ano = this.form.ano
          var aurl = this.form.aurl
          var aname = this.form.aname             
          var alx= this.form.alx
          var anoe= this.form.anoe
          var atexts= this.form.atexts
         var adata= this.form.adata
         var apf= this.form.apf


this.$axios.post('http://localhost:4000/api/updanime/Aupdanime',{aurl:aurl,aname:aname,alx:alx,anoe:anoe,atexts:atexts,adata:adata,apf:apf,ano:ano}).then(res=>{
               
               if(res.status == '200'){
                  
                  // this.$message.success('ä¿®æ”¹æˆåŠŸ~')
                  
               }else{
                 this.$message.error('ä¿®æ”¹å¤±è´¥ï¼')
               }
                

}).catch(err=>{

 window.console.log(err)

})



},
  
      handleDelete(index, row) {

        // row.idæ‹¿å–å½“å‰æ•°æ®çš„idå€¼
        //  console.log(index,row.ano);
      
           this.$axios.post('http://localhost:4000/api/animedel/Adelete?ano=index',{ano:row.ano}).then(
             res=>{
            if(res.status == '200'){
              // å®ç°åˆ é™¤åæ“ä½œ
            
                  this.tableData.splice(index,1)
                // window.console.log(res)
                this.$message.success('æ­å–œåˆ é™¤æˆåŠŸ~')

            }

             }
             
           ).catch()

        
      }
    ,

 handleEdit(index, row) {
        console.log(index, row);
    //  å°†æ•°æ®ç»‘å®šåœ¨inputä¸­
          this.form.ano=row.ano
          this.form.aurl=row.aurl
         this.form.aname=row.aname             
           this.form.alx=row.alx
        this.form.anoe=row.anoe
         this.form.atexts=row.atexts
         this.form.adata=row.adata
        this.form.apf=row.apf
     
      console.log(this.form.anoe)

      },
    

 openFullScreen2() {
        const loading = this.$loading({
          lock: true,
          text: 'åŠ è½½ä¸­...',
          spinner: 'el-icon-loading',
          background: 'rgba(0, 0, 0, 0.7)'
        });
        setTimeout(() => {
          // åˆ·æ–°é—®é¢˜
        //  location.reload();
         //ä¸å‡ºç°é—ªçƒé—®é¢˜  this.reload();
       this.reload();
          loading.close();
           this.$message.success('ä¿®æ”¹æˆåŠŸ~')
        }, 3000);
      }


,


 logouts() {
      window.sessionStorage.clear()
      this.$router.push('/')
    },

}



}
</script>
<style scoped>
 

.el-header{

background: linear-gradient(135deg,#0094ff,rgb(0, 255, 242),rgb(119, 202, 240)) ;;
align-items: center;
display: flex;
font-weight: bold;
font-size: 18px;
align-items: center;
color: #fff;

}

.el-header  span{
margin-left: 10px;
font-size: 20px;
}



.el-aside{

background:linear-gradient(45deg,rgb(6, 191, 216),rgb(0, 143, 238));

}

.el-main{

  background: #fff;
}
.scenes{

height: 100%;

}


.scens{

height: 100vh;

}

.but-t{
position: absolute;
width: 50px;
height: 50px;
float: left;
border-radius: 50%;
background: radial-gradient(rgba(12, 240, 229, 0.753),rgb(22, 75, 190));
padding: 4px;
margin: 4px auto;
font-size: 14px;
font-weight: bold;
transform: 1s;
right: 10px;

}
.but-t:hover{
width: 55px;
height: 55px;
background: radial-gradient(rgba(7, 130, 212, 0.753),rgb(22, 156, 190));;
transform: 1s;
}

a{
   text-decoration: none;
}
.scenes-data  span{
color: #fff;

}
</style>>